# JobSonar

Система автоматического мониторинга вакансий с HH.ru. Фильтрует выдачу по критериям (грейды, зарплата, ключевые слова, стоп-слова) и отправляет уведомления в Telegram.

Архитектура: 4 независимых бота (HR, Analyst, Sales, Recruiter) + Monitor Bot (healthcheck).

## Структура модулей

### 1. HR Bot (`main.py`)
**Цель:** Поиск руководящих HR-позиций (HRD, HRBP, Head of Recruitment, CPO).
* **Логика v6.5 (Strict Mode):**
    * **Фильтрация:** Используется метод "Конструктора". Вакансия проходит валидацию только в двух случаях:
        1.  *Прямое совпадение:* Название есть в `direct_titles` (например, "HR Director").
        2.  *Связка:* В названии есть уровень (`role_levels`) **И** контекст (`hr_context`). Пример: "Руководитель" + "C&B".
    * **География:**
        * Москва и Н.Новгород: Допускаются Office, Hybrid, Remote.
        * Остальные регионы: Только Remote.
    * **Навыки (Skills API):** Бот запрашивает полную карточку вакансии и извлекает теги `key_skills`. Применяется фильтр `BANAL_SKILLS` для очистки от "воды" (коммуникабельность, стрессоустойчивость).

### 2. Analyst Bot (`main_analyst.py`)
**Цель:** Системные, Бизнес и Продуктовые аналитики (Middle/Senior).
* **Логика:**
    * Поиск по ключевым словам + обязательный Hard Skill стек (SQL, Python, BPMN, UML).
    * **Soft Mode (Whitelist):** Для компаний из белого списка снижен порог входа (1 навык вместо 2).
    * Фильтрация по зарплате (понимает вилки "от" и "до").

### 3. Sales Bot (`main_sales.py`)
**Цель:** B2B Sales, KAM, Head of Sales.
* **Логика:**
    * Строгий фильтр на удаленку.
    * Проверка индустрии: исключает стройку, логистику, инфобиз, казино и масс-маркет.
    * Поиск цифровых маркеров в описании (SaaS, IT, Integration).

### 4. Recruiter Bot (`main_recruiter.py`)
**Цель:** IT-рекрутеры и Сорсеры (Line/Middle).
* **Логика:**
    * Исключает руководящие позиции (Head, Lead) — фокус на исполнителях.
    * Строгий фильтр ГЕО (исключает локальные рынки СНГ: КЗ, РБ и др.).
    * Только валюты: RUR, USD, EUR.

### 5. Monitor Bot (`monitor.py`)
Скрипт-сторож. Проверяет наличие процессов, читает статус-файлы и логи.
* Автоматический рестарт при потере соединения (Long Polling).
* Очистка логов при превышении 5 МБ.

## Технические детали

* **База данных:** SQLite (`jobsonar_*.db`). У каждого бота своя БД для исключения блокировок.
* **Anti-Spam:** Хеширование `EmployerID + Title` для предотвращения дублей одной и той же вакансии.
* **HH API:**
    * Использует пагинацию и задержки для обхода Rate Limits.
    * `HR Bot` делает дополнительный запрос `GET /vacancies/{id}` для получения навыков.

## Установка и запуск

1.  Клонировать репозиторий.
2.  Создать `.env` файл с токенами (см. `config.py` каждого бота).
3.  Запуск процессов (рекомендуется `screen`):

```bash
screen -S hr -d -m python3 main.py
screen -S analyst -d -m python3 main_analyst.py
screen -S sales -d -m python3 main_sales.py
screen -S recruiter -d -m python3 main_recruiter.py
screen -S monitor -d -m python3 monitor.py