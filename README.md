# JobSonar v5.2

Комплексная система мониторинга вакансий с умным расписанием, фильтрацией по навыкам, поддержкой удаленки и автономной системой контроля работоспособности.

## Модули системы

### 1. HR Bot (main.py)
Специализированный бот для поиска управленцев в сфере HR.
* **Целевые роли**: HR Director (HRD), HR Business Partner (HRBP), Head of Recruitment, Head of HR.
* **Логика поиска**: Использует комбинированный фильтр. Вакансия проходит, если:
    1.  Содержит прямой маркер топа (например, "HRD", "HRBP").
    2.  ИЛИ содержит комбинацию "Сфера HR" + "Руководящая роль" (например, "Директор" + "по персоналу").
* **Фильтр навыков**: Автоматически парсит описание и вытаскивает хард-скиллы: 1С/ЗУП, КДП, ТК РФ, C&B, Budgeting, English (Upper+).
* **Кого игнорирует**:
    * Линейный персонал (рекрутеры, сорсеры без руководящих функций).
    * Начальные позиции (Assistant, Junior, Intern, Стажер).
    * Непрофильные роли (Офис-менеджеры, Секретари).
    * Локации: Казахстан и другие страны из стоп-листа.

### 2. Analyst Bot (main_analyst.py)
Бот для поиска опытных аналитиков с упором на технический стек.
* **Целевые роли**: System Analyst, Business Analyst, Data Analyst, Product Analyst, BI Analyst.
* **Smart-фильтр стека (Hard Skills)**:
    * Бот ищет ключевые технологии: SQL, Python, ETL, DWH, Kafka, REST/SOAP, BPMN, BI-системы (Tableau, PowerBI, Superset).
    * **Правило "2+ Skills"**: Вакансия отбрасывается, если в описании найдено менее 2-х целевых навыков из списка.
* **Фильтр "Weak Stack"**: Если зарплата не указана или ниже порога, бот проверяет "силу" стека. Если из навыков найдены только Jira и Confluence (без SQL/Python), вакансия считается "слабой" и игнорируется.
* **Зарплатный ценз**: Приоритет вакансиям с зарплатой от 200,000 RUB.
* **Кого игнорирует**:
    * Вакансии "1С Аналитик" (если нет других технических маркеров).
    * Стажеров и джуниоров.

### 3. Sales Bot (main_sales.py)
Бот для поиска менеджеров B2B-продаж в IT и Digital с жесткой фильтрацией условий труда.
* **Целевые роли**: Sales Manager, BizDev (BDM), Account Manager (Kam), Customer Success (CSM), РОП.
* **Фильтр "Anti-Person"**: Блокирует вакансии от ИП и физлиц. Алгоритм анализирует название работодателя на наличие юридических маркеров (ООО, ЗАО, Tech, Group, Soft) и отсеивает подозрительные ФИО.
* **Strict Remote (Строгая удаленка)**: Блокирует вакансии, маскирующиеся под удаленку. Если найдены слова "офис", "гибрид", "на месте", "разъездной характер", "территория" — вакансия улетает в спам.
* **Фильтр сфер деятельности**:
    * **Ищет**: IT, SaaS, EdTech, FinTech, Digital, AI/ML.
    * **Блокирует (Stop-Domains)**: Недвижимость, Логистика/ВЭД, Крипта/Скам, Гемблинг, Стройка, FMCG, Такси, Масс-маркет услуги.
* **Anti-Spam**: Скрывает дубликаты одной и той же вакансии, опубликованные разными HR в рамках одного цикла проверки.

### 4. Monitor Bot (monitor.py)
Служебный модуль-надзиратель.
* **Функции**:
    * Пингует процессы остальных ботов каждые 30 минут.
    * В случае падения процесса присылает уведомление с Traceback (текстом ошибки) администратору.
    * Предоставляет кнопку "Обновить статус" для ручной проверки.
* **Управление логами**: Следит за размером лог-файлов. Если файл лога превышает 5 МБ, монитор автоматически очищает его, сохраняя последние 200 строк для контекста.

## Технические особенности (v5.2)

* **Timezone Correction**: Все логи и отчеты в Telegram приведены к Московскому времени (UTC+3).
* **Secure Config**: Токены и ID чатов вынесены в файл `.env`, который не попадает в репозиторий.
* **Infinity Polling**: Используется механизм бесконечного опроса серверов Telegram с авто-переподключением при разрывах связи.
* **Логирование**: Вывод (stdout/stderr) перенаправляется в файлы `log_*.txt` для удобной отладки через Monitor Bot.

## Установка и запуск

1.  Создать файл `.env` и заполнить токены:
    ```ini
    TG_TOKEN_HR=...
    TG_CHAT_ID_HR=...
    TG_TOKEN_ANALYST=...
    # ... и так далее для всех ботов
    MONITOR_TOKEN=...
    ADMIN_CHAT_ID=...
    ```
2.  Обновить `whitelist.py` (список доверенных компаний).
3.  Установить зависимости:
    `pip install -r requirements.txt`
4.  Запуск через `screen`:

```bash
# HR Bot
screen -S hr -d -m bash -c "python3 -u main.py > log_hr.txt 2>&1"

# Analyst Bot
screen -S analyst -d -m bash -c "python3 -u main_analyst.py > log_analyst.txt 2>&1"

# Sales Bot
screen -S sales -d -m bash -c "python3 -u main_sales.py > log_sales.txt 2>&1"

# Monitor Bot
screen -S monitor -d -m python3 monitor.py