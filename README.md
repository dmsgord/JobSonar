# JobSonar

JobSonar — это система автоматического мониторинга вакансий с HH.ru через API. Система фильтрует вакансии по жестким критериям (зарплата, ключевые слова, график, стоп-слова) и мгновенно отправляет уведомления в Telegram.

Проект состоит из четырех независимых ботов, работающих параллельно, и Супервизора (Монитора), который контролирует здоровье системы.

## Структура проекта

Система разделена на изолированные модули для стабильности. У каждого бота своя база данных SQLite и файл конфигурации.

### 1. HR Bot (main.py)
Фокус на руководящих HR-позициях (HRD, HRBP, Head of HR).
* **Цель:** Управленцы и старшие специалисты.
* **Логика:**
    * Работает по "Белому списку" (Whitelist) топ-800 компаний.
    * Поддерживает роль "HR Generalist", но жестко фильтрует сферы GameDev/3D/Art.
    * **Скрытая удаленка:** Сканирует описание вакансии на маркеры удаленки, даже если тег API отсутствует.
    * **Подсветка:** Отмечает вакансии из топ-компаний специальными маркерами в зависимости от зарплаты.

### 2. Analyst Bot (main_analyst.py)
Фокус на Системных и Продуктовых аналитиках.
* **Цель:** Senior/Middle аналитики, Product Owners.
* **Логика:**
    * Фильтрация по хард-скиллам (SQL, Python, BPMN, UML).
    * Жесткий фильтр по зарплате.
    * Географический фильтр (исключение определенных регионов).

### 3. Sales Bot (main_sales.py)
Фокус на B2B продажах и руководителях отделов продаж.
* **Цель:** Директора по продажам, KAM.
* **Логика:**
    * Строгий фильтр на "чистую удаленку" (исключает гибрид и офисные маркеры).
    * Фильтр сфер: Исключает гэмблинг, крипту, ставки и сомнительные индустрии.
    * Система дедупликации для защиты от спама массовых нанимателей.

### 4. Recruiter Bot (main_recruiter.py)
Фокус на IT-рекрутерах и Сорсерах (Исполнители).
* **Цель:** Сорсеры, Рисерчеры, IT-рекрутеры.
* **Логика:**
    * **Строгая удаленка:** Только полностью удаленные позиции.
    * **Фильтр ролей:** Исключает Руководителей, Лидов, HRD и HR Generalist (фокус на линейный подбор).
    * **Зарплата:** Строго от 100 000 RUB или скрытая.
    * **Подсветка:** Особые маркеры применяются только к компаниям из Whitelist.

### 5. Monitor Bot (monitor.py)
Сторожевой процесс, следящий за четырьмя ботами.
* Проверяет наличие процессов в системе (PID).
* Читает файлы статусов (время последней активности).
* Анализирует логи ошибок (tail check).
* Автоматически очищает логи, если они превышают 5 МБ.
* Присылает отчет о статусе администратору по запросу или при сбое.

## Технические особенности

* **Smart Batching:** Компании из Whitelist обрабатываются пачками по 20 штук для оптимизации лимитов API.
* **Динамический период:** Компании-"Гиганты" (Топ-200) сканируются с меньшим окном (1-2 дня), чтобы избежать переполнения пагинации, остальные — за 3-5 дней.
* **Глобальный поиск:** Помимо Whitelist, система ведет глобальный поиск по ключевым словам с жесткой фильтрацией "Стоп-слов".
* **Анти-дубли:** Уникальные ID вакансий сохраняются в базах SQLite (`jobsonar_hr.db`, `jobsonar_analyst.db`, `jobsonar_sales.db`, `jobsonar_recruiter.db`).
* **Безопасность:** Система корректно обрабатывает лимиты API и разрывы соединения.

## Установка

1.  Клонируйте репозиторий:
    ```bash
    git clone [https://github.com/yourusername/JobSonar.git](https://github.com/yourusername/JobSonar.git)
    cd JobSonar
    ```

2.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
    *Важно: Убедитесь, что установлена библиотека `pyTelegramBotAPI`, а не `telebot`.*

3.  Настройте переменные окружения. Создайте файл `.env` в корневой директории:

    ```ini
    # HR Bot
    TG_TOKEN_HR=ваш_токен
    TG_CHAT_ID_HR=ваш_id_чата

    # Analyst Bot
    TG_TOKEN_ANALYST=ваш_токен
    TG_CHAT_ID_ANALYST=ваш_id_чата

    # Sales Bot
    TG_TOKEN_SALES=ваш_токен
    TG_CHAT_ID_SALES=ваш_id_чата

    # Recruiter Bot
    TG_TOKEN_RECRUITER=ваш_токен
    TG_CHAT_ID_RECRUITER=ваш_id_чата

    # Monitor
    MONITOR_TOKEN=токен_монитора
    ADMIN_CHAT_ID=ваш_личный_id
    ```

## Использование

Рекомендуется запускать ботов через `screen` для работы в фоне.

### Команды запуска

```bash
# Запуск HR Bot
screen -S hr -d -m python3 main.py

# Запуск Analyst Bot
screen -S analyst -d -m python3 main_analyst.py

# Запуск Sales Bot
screen -S sales -d -m python3 main_sales.py

# Запуск Recruiter Bot
screen -S recruiter -d -m python3 main_recruiter.py

# Запуск Monitor
screen -S monitor -d -m python3 monitor.py